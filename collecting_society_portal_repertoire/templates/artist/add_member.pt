<!--! For copyright / license terms, see COPYRIGHT.rst (top level of repository)
      Repository: https://github.com/C3S/collecting_society.portal.repertoire -->
<tal:block metal:use-macro="backend39" i18n:domain="collecting_society_portal_repertoire">

    <!-- content left -->
    <tal:block metal:fill-slot="content-left"></tal:block>

    <!-- content right -->
    <tal:block metal:fill-slot="content-right">
        <div class="cs-symbolnavbar">
            <a href="javascript: history.back(1);">
                <span class="glyphicon glyphicon-arrow-left"></span>
            </a>
            <a href="${request.resource_path(context, 'show', context.group.code)}">
                <span class="glyphicon glyphicon-eye-open"></span>
            </a>
            <a href="${request.resource_path(context, 'list')}">
                <span class="glyphicon glyphicon-list"></span>
            </a>
        </div>

        <h1><span i18n:translate="">Add a member to</span> "${context.group.name}"</h1>

        <!-- add artist -->
        <tal:block tal:condition="AddArtistMember|False">
            <table id="cs-table-addartistmember"
                   class="table table-hover cs-datatables">
                <thead>
                    <th i18n:translate=""></th>
                    <th i18n:translate="">Name</th>
                    <th i18n:translate="">Code</th>
                    <th i18n:translate=""></th>
                </thead>
                <tfoot>
                    <th i18n:translate=""></th>
                    <th i18n:translate="" class="multifilter">Name</th>
                    <th i18n:translate="" class="multifilter">Code</th>
                    <th i18n:translate=""></th>
                </tfoot>
            </table>
            <script>
                /* format */
                function addartistmember_more_col( data, type, row ) {
                    if(data.description)
                        return '<span class="more">' +
                                    '<span class="glyphicon glyphicon-zoom-in"></span>' +
                               '</span>';
                    return "";
                }
                function addartistmember_more_div( data ) {
                    return  '<table class="table">' +
                                '<tr>' +
                                    '<th i18n:translate="">Description</th>' +
                                    '<td>' + data.description + '</td>' +
                                '</tr>' +
                            '</table>';
                }
                function addartistmember_add_col( data, type, row ) {
                    return  '<a href="#">' +
                                '<span class="glyphicon glyphicon-plus"></span> ' +
                                '<span i18n:translate="">Add</span>' +
                            '</a>';
                }
                /* datatables */
                $(document).ready(function() {
                    /* initialize */
                    var addartistmember = $('#cs-table-addartistmember').DataTable({
                        processing: true,
                        serverSide: true,
                        searchDelay: 600,
                        ajax: {
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            url: "${api_url}/artists",
                            xhrFields: {withCredentials: true},
                            dataType: "json",
                            data: function(args) {
                                return JSON.stringify(args);
                            }
                        },
                        "columns": [
                            {
                                "name": "more",
                                "orderable": false,
                                "searchable": false,
                                "data": null,
                                "render": addartistmember_more_col
                            },
                            {
                                "name": "name",
                                "data": "name",
                                "orderable": true
                            },
                            {
                                "name": "code",
                                "data": "code",
                                "orderable": true
                            },
                            {
                                "name": "add",
                                "className": "text-right",
                                "orderable": false,
                                "searchable": false,
                                "data": null,
                                "render": addartistmember_add_col
                            },
                            {
                                "name": "group",
                                "data": "group",
                                "orderable": false,
                                "searchable": true,
                                "visible": false
                            },
                        ],
                        "searchCols": [
                            null,
                            null,
                            null,
                            null,
                            { "search": "False" }
                        ],
                        "order": [
                            [ 1, "desc" ]
                        ]
                    });
                    /* more */
                    $('#cs-table-addartistmember tbody').on('click', 'span.more', function () {
                        var tr = $(this).closest('tr');
                        var row = addartistmember.row( tr );
                        if ( row.child.isShown() ) {
                            row.child.hide();
                            tr.removeClass('shown');
                            $(this).html(
                                '<span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>');
                        } else {
                            row.child( addartistmember_more_div(row.data()) ).show();
                            tr.addClass('shown');
                            $(this).html(
                                '<span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>');
                        }
                    });
                    /* column search */
                    $('#cs-table-addartistmember tfoot th.multifilter').each(function () {
                        var title = $(this).text();
                        $(this).html('<input type="text" placeholder="Search '+title+'" />');
                    });
                    addartistmember.columns().every(function () {
                        var that = this;
                        $('input', this.footer()).on('keyup change', function() {
                            if (that.search() !== this.value) {
                                that.search( this.value ).draw();
                            }
                        });
                    });
                });
            </script>
        </tal:block>

        <tal:block tal:condition="CreateArtistMember|False">
            <h2 i18n:translate="">Create Artist</h2>
            <div tal:content="structure CreateArtistMember"/>
        </tal:block>

    </tal:block>

</tal:block>