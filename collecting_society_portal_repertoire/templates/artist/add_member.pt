<!--! For copyright / license terms, see COPYRIGHT.rst (top level of repository)
      Repository: https://github.com/C3S/collecting_society.portal.repertoire -->
<tal:block metal:use-macro="backend39" i18n:domain="collecting_society_portal_repertoire">

    <!-- content left -->
    <tal:block metal:fill-slot="content-left"></tal:block>

    <!-- content right -->
    <tal:block metal:fill-slot="content-right">
        <div class="cs-symbolnavbar">
            <a href="javascript: history.back(1);">
                <span class="glyphicon glyphicon-arrow-left"></span>
            </a>
            <a href="${request.resource_path(context, 'show', context.group.code)}">
                <span class="glyphicon glyphicon-eye-open"></span>
            </a>
            <a href="${request.resource_path(context, 'list')}">
                <span class="glyphicon glyphicon-list"></span>
            </a>
        </div>

        <h1><span i18n:translate="">Add a member to</span> "${context.group.name}"</h1>

        <tal:block tal:condition="SearchArtistMember|False">
            <h2 i18n:translate="">Search Artist</h2>
            <div tal:content="structure SearchArtistMember"/>
        </tal:block>

        <tal:block tal:condition="AddArtistMember|False">
            <h2 i18n:translate="">Add Artist</h2>
            <div class="alert alert-warning" role="alert"
                 tal:condition="not artists|False"
                 i18n:translate="">No Search results</div>
            <table id="cs-table-addartistmember"
                   class="table table-striped cs-datatables"
                   tal:condition="artists|False">
                <thead>
                    <th i18n:translate=""></th>
                    <th i18n:translate="">Name</th>
                    <th i18n:translate="">Code</th>
                    <th i18n:translate=""></th>
                </thead>
            </table>

            <script>

                /* format */
                function format_addartistmember_more_col( data, type, row ) {
                    if(data.description)
                        return '<span class="more">' +
                                    '<span class="glyphicon glyphicon-zoom-in"></span>' +
                               '</span>';
                    return "";
                }
                function format_addartistmember_more_div( data ) {
                    return  '<table class="table">' +
                                '<tr>' +
                                    '<th i18n:translate="">Description</th>' +
                                    '<td>' + data.description + '</td>' +
                                '</tr>' +
                            '</table>';
                }
                /* datatables */
                $(document).ready(function() {

                    /* initialize datatables */
                    var table_addartistmember = $('#cs-table-addartistmember').DataTable({
                        processing: true,
                        serverSide: true,
                        ajax: {
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            url: "${api_url}/artists",
                            xhrFields: {withCredentials: true},
                            dataType: "json",
                            data: function(args) { return JSON.stringify(args); }
                        },
                        "columns": [
                            {
                                "name": "more",
                                "orderable": false,
                                "data": null,
                                "render": format_addartistmember_more_col
                            },
                            {
                                "name": "name",
                                "data": "name",
                                "orderable": true
                            },
                            {
                                "name": "code",
                                "data": "code",
                                "orderable": true
                            },
                            {
                                "name": "add",
                                "className": "add",
                                "orderable": false,
                                "data": null,
                                "defaultContent": "add"
                            },
                        ],
                        "order": [
                            [ 1, "desc" ]
                        ]
                    });

                    /* add eventhandler */
                    $('#cs-table-addartistmember tbody').on('click', 'span.more', function () {
                        var tr = $(this).closest('tr');
                        var row = table_addartistmember.row( tr );
                        if ( row.child.isShown() ) {
                            row.child.hide();
                            tr.removeClass('shown');
                            $(this).html(
                                '<span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>');
                        } else {
                            row.child( format_addartistmember_more_div(row.data()) ).show();
                            tr.addClass('shown');
                            $(this).html(
                                '<span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>');
                        }
                    } );

                });
            </script>

        </tal:block>

        <tal:block tal:condition="CreateArtistMember|False">
            <h2 i18n:translate="">Create Artist</h2>
            <div tal:content="structure CreateArtistMember"/>
        </tal:block>

    </tal:block>

</tal:block>